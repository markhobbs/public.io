<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Spectrum Derby (Modern)</title>
  <style>
    :root {
      --track-length: 80vw;
      --horse-size: 2rem;
    }
    body { font-family: sans-serif; background: #fafafa; }
    main { max-width: 900px; margin: 2rem auto; }
    .track {
      display: flex; flex-direction: column; gap: 1rem;
      margin-bottom: 2rem;
    }
    .horse-row {
      display: flex; align-items: center; position: relative; height: var(--horse-size);
      background: #eee; border-radius: 1rem;
    }
    .horse {
      height: var(--horse-size); width: var(--horse-size);
      border-radius: 50%; background: #007bff; color: #fff;
      display: flex; align-items: center; justify-content: center;
      position: absolute; left: 0; transition: left 0.2s cubic-bezier(.23,1.22,.74,1.01);
    }
    .horse[aria-current="true"] { background: #28a745; }
    .finish-line {
      position: absolute; right: 0; top: 0; bottom: 0;
      width: 0.5rem; background: repeating-linear-gradient(
        45deg, white, white 5px, #222 5px, #222 10px
      );
    }
    button { font-size: 1.2rem; margin: 0 0.5rem; }
  </style>
</head>
<body>
  <main>
    <h1>Spectrum Derby (Modern HTML5)</h1>
    <section class="track" id="track" aria-label="Horse race track"></section>
    <div>
      <button id="startBtn">Start Race</button>
      <button id="resetBtn">Reset</button>
    </div>
    <p id="status" role="status"></p>
  </main>
  <script type="module">
    // Config
    const HORSES = [
      { name: "Red", color: "#e74c3c" },
      { name: "Blue", color: "#3498db" },
      { name: "Green", color: "#27ae60" },
      { name: "Yellow", color: "#f1c40f" }
    ];
    const TRACK_LENGTH = 100; // virtual units

    // DOM Elements
    const trackEl = document.getElementById('track');
    const statusEl = document.getElementById('status');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    let raceInterval, positions;

    // Render Track
    function renderTrack() {
      trackEl.innerHTML = '';
      HORSES.forEach((horse, i) => {
        const row = document.createElement('div');
        row.className = 'horse-row';
        row.setAttribute('role', 'listitem');
        row.setAttribute('aria-label', `${horse.name} horse row`);
        row.innerHTML = `
          <div class="horse" id="horse${i}" style="background:${horse.color}" tabindex="0" aria-label="${horse.name}" aria-current="false">${horse.name[0]}</div>
          <div class="finish-line" aria-hidden="true"></div>
        `;
        trackEl.appendChild(row);
      });
    }

    // Update Positions
    function updatePositions() {
      HORSES.forEach((_, i) => {
        const horseEl = document.getElementById(`horse${i}`);
        const percent = Math.min(positions[i] / TRACK_LENGTH, 1);
        horseEl.style.left = `calc(${percent} * (var(--track-length) - var(--horse-size)))`;
        horseEl.setAttribute('aria-current', "false");
      });
    }

    // Start Race
    function startRace() {
      startBtn.disabled = true;
      statusEl.textContent = "Race in progress...";
      positions = HORSES.map(() => 0);
      updatePositions();
      raceInterval = setInterval(() => {
        HORSES.forEach((_, i) => {
          positions[i] += Math.random() * 6 + 1;
        });
        updatePositions();
        const winner = positions.findIndex(pos => pos >= TRACK_LENGTH);
        if (winner !== -1) {
          clearInterval(raceInterval);
          document.getElementById(`horse${winner}`).setAttribute('aria-current', "true");
          statusEl.textContent = `🏆 ${HORSES[winner].name} wins!`;
          startBtn.disabled = false;
        }
      }, 100);
    }

    // Reset Race
    function resetRace() {
      if (raceInterval) clearInterval(raceInterval);
      positions = HORSES.map(() => 0);
      updatePositions();
      statusEl.textContent = "Ready for the next race!";
      startBtn.disabled = false;
    }

    // Accessibility: Keyboard support for start/reset
    startBtn.addEventListener('keydown', e => {
      if (e.key === 'Enter' || e.key === ' ') startRace();
    });
    resetBtn.addEventListener('keydown', e => {
      if (e.key === 'Enter' || e.key === ' ') resetRace();
    });

    // Event Listeners
    startBtn.addEventListener('click', startRace);
    resetBtn.addEventListener('click', resetRace);

    // Init
    renderTrack();
    resetRace();
  </script>
</body>
</html>