(function(){var b=0,f=1,g=5000,h=0,l=null,m=true,n=2,p=300,q=null,r=false,s=5,t=0.5,u=[],v=[];var w=document.getElementById("container-app-1"),x=document.getElementById("history"),y=document.getElementById("lanes"),z=document.getElementById("message"),A=document.getElementById("selectors"),B=document.getElementById("wallet"),C=document.getElementById("btn-reset-history"),D=document.getElementById("btn-reset"),E=document.getElementById("btn-start"),F=w?w.getElementsByClassName("track"):[];if(!w||!y||!z||!B||!A||!x||!D||!C||!E){alert("Some UI elements are missing. Game cannot load.");return;}var G=[{id:200,color:"#000000",dark:true,name:"black"},{id:100,color:"#0000ff",dark:true,name:"blue"},{id:50,color:"#ff0000",dark:false,name:"red"},{id:20,color:"#ff00ff",dark:false,name:"magenta"},{id:10,color:"#00ff00",dark:false,name:"green"},{id:5,color:"#00ffff",dark:false,name:"cyan"},{id:2,color:"#ffff00",dark:false,name:"yellow"},{id:1,color:"#d8d8d8",dark:false,name:"white"}];var H={},I={getItem:function(a){try{return window.localStorage.getItem(a);}catch(e){return H[a]||null;}},setItem:function(a,c){try{window.localStorage.setItem(a,c);}catch(e){H[a]=c;}},removeItem:function(a){try{window.localStorage.removeItem(a);}catch(e){delete H[a];}}};function J(){var a=[0.01,0.02,0.05,0.10,0.20,0.50,1,2];return a[Math.floor(Math.random()*a.length)];}function K(a){return Math.floor(Math.random()*a);}function L(a){var c=I.getItem("history"),d=c?c+","+a:a;I.setItem("history",d);M();}function M(){var a=I.getItem("history");if(a){C.removeAttribute("disabled");for(var c=a.split(","),d={},e=0;e<c.length;e++){var k=c[e];d[k]=(d[k]||0)+1;}x.innerHTML="<pre>"+JSON.stringify(d,null,2)+"</pre>";}else{C.setAttribute("disabled","disabled");x.innerHTML="<p>No Race History As Yet</p>";}}function N(){E.addEventListener("click",T,false);D.addEventListener("click",U,false);C.addEventListener("click",O,false);}function O(){if(confirm("Are You Sure? This Action Will Delete All Race History.")){I.removeItem("history");M();}}function P(a,d,e){var k="<p>Resetting Race in "+s+" seconds.</p>",j="Hooray <strong class='upper'>"+e+"</strong> is the Winner! You Won <strong>"+d+"</strong> Credits.</p>"+k,i="<strong class='upper'>"+e+"</strong> is the Winner! You Lose <strong>"+d+"</strong> Credits.</p>"+k;if(a===d){z.innerHTML=j;V(d);}else{z.innerHTML=i;V(-d);}W(a);D.removeAttribute("disabled");if(q)clearTimeout(q);q=setTimeout(U,s*1000);}function Q(a){if(r){alert("No Bets Please! Race in Progress.");return;}D.removeAttribute("disabled");if(b<f){var c=document.getElementById(this.name);c.classList.add("active");h=c.getAttribute("id");R();this.classList.add("active");b++;}else{alert("Only 1 Bet Per Race! Select Reset to Choose Again.");}}function R(){for(var a=0;a<v.length;a++)v[a].disabled=true;E.removeAttribute("disabled");}function S(){for(var a=0;a<v.length;a++){v[a].classList.remove("active","winner","loser");v[a].disabled=false;}E.setAttribute("disabled","disabled");D.setAttribute("disabled","disabled");A.classList.remove("disabled");}function U(){r=false;if(q)clearTimeout(q);if(l)clearTimeout(l);z.innerHTML="";var a=parseInt(B.value,10);if(a>0){S();Y();}else{alert("Funds Required to Reset Race! Refresh Page to Start Again.");}}function Y(){b=0;for(var a=0;a<u.length;a++){u[a].style.width=n+"px";u[a].classList.remove("active");}}function T(){r=true;p=F[0].clientWidth;u=w.querySelectorAll(".lane");window.requestAnimationFrame(X);z.innerHTML="No Bets Please! Race in Progress.";E.setAttribute("disabled","disabled");D.setAttribute("disabled","disabled");A.classList.add("disabled");if(m)l=setInterval(Z,t*1000);}function Z(){if(v.length<2)return;var a=K(v.length),c;do{c=K(v.length);}while(c===a);for(var d=0;d<v.length;d++)v[d].classList.remove("winner","loser");v[a].classList.add("loser");v[c].classList.add("winner");}function $(a){for(var c=0;c<v.length;c++){v[c].classList.remove("winner","loser");if(Math.random()<0.5)v[c].classList.add("winner");else v[c].classList.add("loser");}}function X(){if(!r)return;var a=-1;for(var c=0;c<u.length;c++){var d=u[c],e=d.offsetWidth,k=n,j=Math.floor(e+(k*J()));if(e<p){d.style.width=j+"px";}else if(a===-1){a=c;}}k++;if(a>-1){if(m){for(var c=0;c<v.length;c++){v[c].classList.remove("winner","loser");v[c].disabled=false;}clearTimeout(l);}var e=u[a],d=e.getElementsByTagName("span")[0].innerHTML,f=e.getAttribute("id");r=false;P(f,h,d);L(f);}else{window.requestAnimationFrame(X);}}function aa(){var a="",c="";for(var d=0;d<G.length;d++){var e=G[d],k=e.dark?"dark":"";a+='<div style="background-color: '+e.color+'" id="'+e.id+'" class="lane '+k+'"><span>'+e.name+"</span></div>";c+='<button style="background-color: '+e.color+'" name="'+e.id+'" class="btn-selector '+k+'">'+e.id+"<sup>c</sup></button>";}y.innerHTML=a;A.innerHTML=c;u=w.querySelectorAll(".lane");v=w.querySelectorAll(".btn-selector");for(var d=0;d<v.length;d++)v[d].addEventListener("click",Q,false);}function W(a){for(var c=0;c<v.length;c++)v[c].name===a?v[c].classList.add("winner"):v[c].classList.add("loser");}function ab(){B.value=g;aa();M();N();}function V(a){var c=parseInt(B.value,10);c+=parseInt(a,10);B.value=c;}window.onload=function(){ab();S();};})();
